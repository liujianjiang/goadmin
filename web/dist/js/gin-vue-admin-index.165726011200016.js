/*! 
 Build based on gin-vue-admin 
 Time : 1657260112000 */
var e=(e,l,a)=>new Promise(((t,i)=>{var o=e=>{try{d(a.next(e))}catch(l){i(l)}},u=e=>{try{d(a.throw(e))}catch(l){i(l)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);d((a=a.apply(e,l)).next())}));import l from"./gin-vue-admin-fieldDialog.1657260112000.js";import a from"./gin-vue-admin-previewCodeDialg.1657260112000.js";import{a as t,b as i,t as o,c as u}from"./gin-vue-admin-stringFun.1657260112000.js";import{p as d,c as n,g as s,a as r,b as m,d as p,e as c}from"./gin-vue-admin-autoCode.1657260112000.js";import{u as v}from"./gin-vue-admin-dictionary.1657260112000.js";import{_ as f,I as b,u as g,a as y,r as N,Q as h,b as k,o as _,c as V,e as w,d as C,w as x,F as T,z as U,q as z,ae as S,f as F,h as j,p as D,l as q,i as L,af as J}from"../gva/gin-vue-admin-index.1657260112000.js";import{W as A}from"./gin-vue-admin-warningBar.1657260112000.js";import"./gin-vue-admin-sysDictionary.1657260112000.js";const O=e=>(D("data-v-34e49a9a"),e=e(),q(),e),P={class:"gva-search-box"},B={style:{fontSize:"16px",paddingLeft:"20px"}},E=j(" 点这里从现有数据库创建代码 "),M=j("使用此表创建"),I={class:"gva-search-box"},$=O((()=>C("div",null," 自动创建API ",-1))),R=O((()=>C("div",null," 自动移动文件 ",-1))),X={class:"gva-table-box"},Q={class:"gva-btn-list"},W=j("新增Field"),G=j("编辑"),H=j("上移"),K=j("下移"),Y=O((()=>C("p",null,"确定删除吗？",-1))),Z={style:{"text-align":"right","margin-top":"8px"}},ee=j("取消"),le=j("确定"),ae=j("删除"),te={class:"gva-btn-list justify-content-flex-end auto-btn-list"},ie=j("预览代码"),oe=j("生成代码"),ue={class:"dialog-footer"},de=j("取 消"),ne=j("确 定"),se={class:"previewCodeTool"},re=O((()=>C("p",null,"操作栏：",-1))),me=j("全选"),pe=j("复制"),ce={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},ve=j("确 定"),fe={name:"AutoCode"};var be=f(Object.assign(fe,{setup(f){const j={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",fieldSearchType:"",dictType:""},D=b(),q=g(),O=y([]),fe=N({}),be=N({dbName:"",tableName:""}),ge=N([]),ye=N([]),Ne=N(""),he=N({}),ke=N({structName:"",tableName:"",packageName:"",package:"",abbreviation:"",description:"",autoCreateApiToSql:!0,autoMoveFile:!0,fields:[]}),_e=N({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}],package:[{required:!0,message:"请选择package",trigger:"blur"}]}),Ve=N({}),we=N({}),Ce=N(!1),xe=N(!1),Te=N(null),Ue=()=>{Te.value.selectText()},ze=()=>{Te.value.copy()},Se=e=>{Ce.value=!0,e?(Ne.value="edit",we.value=JSON.parse(JSON.stringify(e)),Ve.value=e):(Ne.value="add",Ve.value=JSON.parse(JSON.stringify(j)))},Fe=J(),je=()=>{Fe.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;Ve.value.fieldName=i(Ve.value.fieldName),"add"===Ne.value&&ke.value.fields.push(Ve.value),Ce.value=!1}))},De=()=>{"edit"===Ne.value&&(Ve.value=we.value),Ce.value=!1},qe=N(null),Le=l=>e(this,null,(function*(){return ke.value.fields.length<=0?(L({type:"error",message:"请填写至少一个field"}),!1):ke.value.fields.some((e=>e.fieldName===ke.value.structName))?(L({type:"error",message:"存在与结构体同名的字段"}),!1):void qe.value.validate((a=>e(this,null,(function*(){var e;if(!a)return!1;for(const l in ke.value)"string"==typeof ke.value[l]&&(ke.value[l]=ke.value[l].trim());if(ke.value.structName=i(ke.value.structName),ke.value.tableName=ke.value.tableName.replace(" ",""),ke.value.tableName||(ke.value.tableName=o(t(ke.value.structName))),ke.value.structName===ke.value.abbreviation)return L({type:"error",message:"structName和struct简称不能相同"}),!1;if(ke.value.humpPackageName=o(ke.value.packageName),l){const e=yield d(ke.value);fe.value=e.data.autoCode,xe.value=!0}else{const l=yield n(ke.value);if("false"===(null==(e=l.headers)?void 0:e.success))return;if(ke.value.autoMoveFile)return void L({type:"success",message:"自动化代码创建成功，自动移动成功"});L({type:"success",message:"自动化代码创建成功，正在下载"});const a=new Blob([l]),t="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(a),l=document.createElement("a");l.style.display="none",l.href=e,l.setAttribute("download",t),document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(a,t)}}))))})),Je=()=>e(this,null,(function*(){const e=yield p();0===e.code&&(ge.value=e.data.dbs)})),Ae=()=>e(this,null,(function*(){const e=yield s({dbName:be.value.dbName});0===e.code&&(ye.value=e.data.tables),be.value.tableName=""})),Oe=()=>e(this,null,(function*(){const e=["id","created_at","updated_at","deleted_at"],l=yield r(be.value);if(0===l.code){const a=u(be.value.tableName);ke.value.structName=i(a),ke.value.tableName=be.value.tableName,ke.value.packageName=a,ke.value.abbreviation=a,ke.value.description=a+"表",ke.value.autoCreateApiToSql=!0,ke.value.autoMoveFile=!0,ke.value.fields=[],l.data.columns&&l.data.columns.forEach((l=>{if(!e.some((e=>e===l.columnName))){const e=u(l.columnName);ke.value.fields.push({fieldName:i(e),fieldDesc:l.columnComment||e+"字段",fieldType:he.value[l.dataType],dataType:l.dataType,fieldJson:e,dataTypeLong:l.dataTypeLong&&l.dataTypeLong.split(",")[0],columnName:l.columnName,comment:l.columnComment,fieldSearchType:"",dictType:""})}}))}})),Pe=()=>e(this,null,(function*(){["string","int","bool","float64","time.Time"].forEach((l=>e(this,null,(function*(){const a=yield(t=l,e(void 0,null,(function*(){const e=v();return yield e.getDictionary(t),e.dictionaryMap[t]})));var t;a&&a.forEach((e=>{he.value[e.label]=l}))}))))})),Be=l=>e(this,null,(function*(){const e=yield c({id:Number(l)});0===e.code&&(ke.value=JSON.parse(e.data.meta))})),Ee=N([]),Me=()=>e(this,null,(function*(){const e=yield m();0===e.code&&(Ee.value=e.data.pkgs)})),Ie=()=>{q.push({name:"autoPkg"})},$e=()=>{Je(),Pe(),Me();const e=D.params.id;e&&Be(e)};return $e(),h((()=>D.params.id),(e=>{"autoCodeEdit"===D.name&&$e()})),(e,i)=>{const o=k("pointer"),u=k("el-icon"),d=k("el-option"),n=k("el-select"),s=k("el-form-item"),r=k("el-button"),m=k("el-form"),p=k("el-collapse-item"),c=k("el-collapse"),v=k("el-input"),f=k("refresh"),b=k("document-add"),g=k("el-tooltip"),y=k("el-checkbox"),N=k("el-table-column"),h=k("el-popover"),j=k("el-table"),D=k("el-dialog");return _(),V("div",null,[w(A,{href:"https://www.bilibili.com/video/BV1kv4y1g7nT?p=3",title:"此功能为开发环境使用，不建议发布到生产，具体使用效果请看视频https://www.bilibili.com/video/BV1kv4y1g7nT?p=3"}),C("div",P,[w(c,{modelValue:O,"onUpdate:modelValue":i[2]||(i[2]=e=>S(O)?O.value=e:null),style:{"margin-bottom":"12px"}},{default:x((()=>[w(p,{name:"1"},{title:x((()=>[C("div",B,[E,w(u,{class:"header-icon"},{default:x((()=>[w(o)])),_:1})])])),default:x((()=>[w(m,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:be.value,"label-width":"120px"},{default:x((()=>[w(s,{label:"数据库名",prop:"structName"},{default:x((()=>[w(n,{modelValue:be.value.dbName,"onUpdate:modelValue":i[0]||(i[0]=e=>be.value.dbName=e),filterable:"",placeholder:"请选择数据库",onChange:Ae},{default:x((()=>[(_(!0),V(T,null,U(ge.value,(e=>(_(),z(d,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),w(s,{label:"表名",prop:"structName"},{default:x((()=>[w(n,{modelValue:be.value.tableName,"onUpdate:modelValue":i[1]||(i[1]=e=>be.value.tableName=e),disabled:!be.value.dbName,filterable:"",placeholder:"请选择表"},{default:x((()=>[(_(!0),V(T,null,U(ye.value,(e=>(_(),z(d,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),w(s,null,{default:x((()=>[w(r,{size:"small",type:"primary",onClick:Oe},{default:x((()=>[M])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),C("div",I,[w(m,{ref_key:"autoCodeForm",ref:qe,rules:_e.value,model:ke.value,"label-width":"120px",inline:!0},{default:x((()=>[w(s,{label:"Struct名称",prop:"structName"},{default:x((()=>[w(v,{modelValue:ke.value.structName,"onUpdate:modelValue":i[3]||(i[3]=e=>ke.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),w(s,{label:"TableName",prop:"tableName"},{default:x((()=>[w(v,{modelValue:ke.value.tableName,"onUpdate:modelValue":i[4]||(i[4]=e=>ke.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),w(s,{label:"Struct简称",prop:"abbreviation"},{default:x((()=>[w(v,{modelValue:ke.value.abbreviation,"onUpdate:modelValue":i[5]||(i[5]=e=>ke.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),w(s,{label:"Struct中文名称",prop:"description"},{default:x((()=>[w(v,{modelValue:ke.value.description,"onUpdate:modelValue":i[6]||(i[6]=e=>ke.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),w(s,{label:"文件名称",prop:"packageName"},{default:x((()=>[w(v,{modelValue:ke.value.packageName,"onUpdate:modelValue":i[7]||(i[7]=e=>ke.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:i[8]||(i[8]=e=>{var l,a;(l=ke.value)[a="packageName"]=t(l[a])})},null,8,["modelValue"])])),_:1}),w(s,{label:"Package（包）",prop:"package"},{default:x((()=>[w(n,{modelValue:ke.value.package,"onUpdate:modelValue":i[9]||(i[9]=e=>ke.value.package=e),style:{width:"194px"}},{default:x((()=>[(_(!0),V(T,null,U(Ee.value,(e=>(_(),z(d,{key:e.ID,value:e.packageName,label:e.packageName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),w(u,{class:"auto-icon",onClick:Me},{default:x((()=>[w(f)])),_:1}),w(u,{class:"auto-icon",onClick:Ie},{default:x((()=>[w(b)])),_:1})])),_:1}),w(s,null,{label:x((()=>[w(g,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:x((()=>[$])),_:1})])),default:x((()=>[w(y,{modelValue:ke.value.autoCreateApiToSql,"onUpdate:modelValue":i[10]||(i[10]=e=>ke.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),w(s,null,{label:x((()=>[w(g,{content:"注：自动迁移生成的文件到yaml配置的对应位置",placement:"bottom",effect:"light"},{default:x((()=>[R])),_:1})])),default:x((()=>[w(y,{modelValue:ke.value.autoMoveFile,"onUpdate:modelValue":i[11]||(i[11]=e=>ke.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),C("div",X,[C("div",Q,[w(r,{size:"small",type:"primary",onClick:i[12]||(i[12]=e=>Se())},{default:x((()=>[W])),_:1})]),w(j,{data:ke.value.fields},{default:x((()=>[w(N,{align:"left",type:"index",label:"序列",width:"100"}),w(N,{align:"left",prop:"fieldName",label:"Field名"}),w(N,{align:"left",prop:"fieldDesc",label:"中文名"}),w(N,{align:"left",prop:"fieldJson",label:"FieldJson"}),w(N,{align:"left",prop:"fieldType",label:"Field数据类型",width:"130"}),w(N,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"130"}),w(N,{align:"left",prop:"columnName",label:"数据库字段",width:"130"}),w(N,{align:"left",prop:"comment",label:"数据库字段描述",width:"130"}),w(N,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"}),w(N,{align:"left",prop:"dictType",label:"字典",width:"130"}),w(N,{align:"left",label:"操作",width:"300"},{default:x((e=>[w(r,{size:"small",type:"primary",link:"",icon:"edit",onClick:l=>Se(e.row)},{default:x((()=>[G])),_:2},1032,["onClick"]),w(r,{size:"small",type:"primary",link:"",disabled:0===e.$index,onClick:l=>(e=>{if(0===e)return;const l=ke.value.fields[e-1];ke.value.fields.splice(e-1,1),ke.value.fields.splice(e,0,l)})(e.$index)},{default:x((()=>[H])),_:2},1032,["disabled","onClick"]),w(r,{size:"small",type:"primary",link:"",disabled:e.$index+1===ke.value.fields.length,onClick:l=>(e=>{if(e===ke.value.fields.length-1)return;const l=ke.value.fields[e+1];ke.value.fields.splice(e+1,1),ke.value.fields.splice(e,0,l)})(e.$index)},{default:x((()=>[K])),_:2},1032,["disabled","onClick"]),w(h,{modelValue:e.row.visible,"onUpdate:modelValue":l=>e.row.visible=l,placement:"top"},{reference:x((()=>[w(r,{size:"small",type:"primary",link:"",icon:"delete",onClick:l=>e.row.visible=!0},{default:x((()=>[ae])),_:2},1032,["onClick"])])),default:x((()=>[Y,C("div",Z,[w(r,{size:"small",type:"primary",link:"",onClick:l=>e.row.visible=!1},{default:x((()=>[ee])),_:2},1032,["onClick"]),w(r,{type:"primary",size:"small",onClick:l=>{return a=e.$index,void ke.value.fields.splice(a,1);var a}},{default:x((()=>[le])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),C("div",te,[w(r,{size:"small",type:"primary",onClick:i[13]||(i[13]=e=>Le(!0))},{default:x((()=>[ie])),_:1}),w(r,{size:"small",type:"primary",onClick:i[14]||(i[14]=e=>Le(!1))},{default:x((()=>[oe])),_:1})])]),w(D,{modelValue:Ce.value,"onUpdate:modelValue":i[15]||(i[15]=e=>Ce.value=e),title:"组件内容"},{footer:x((()=>[C("div",ue,[w(r,{size:"small",onClick:De},{default:x((()=>[de])),_:1}),w(r,{size:"small",type:"primary",onClick:je},{default:x((()=>[ne])),_:1})])])),default:x((()=>[Ce.value?(_(),z(l,{key:0,ref:"fieldDialogNode","dialog-middle":Ve.value},null,8,["dialog-middle"])):F("",!0)])),_:1},8,["modelValue"]),w(D,{modelValue:xe.value,"onUpdate:modelValue":i[17]||(i[17]=e=>xe.value=e)},{header:x((()=>[C("div",se,[re,w(r,{size:"small",type:"primary",onClick:Ue},{default:x((()=>[me])),_:1}),w(r,{size:"small",type:"primary",onClick:ze},{default:x((()=>[pe])),_:1})])])),footer:x((()=>[C("div",ce,[w(r,{size:"small",type:"primary",onClick:i[16]||(i[16]=e=>xe.value=!1)},{default:x((()=>[ve])),_:1})])])),default:x((()=>[xe.value?(_(),z(a,{key:0,ref_key:"previewNode",ref:Te,"preview-code":fe.value},null,8,["preview-code"])):F("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-34e49a9a"]]);export{be as default};
